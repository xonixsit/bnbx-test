<div class="wrapper">
    <div id="content" class="active-content">
        <div class="container">
            <!-- Back Button -->
            <div class="d-flex justify-content-end">
                <button class="btn btn-primary mb-3" (click)="goBack()">
                    <i class="fa fa-arrow-left"></i> Back
                </button>
            </div>
            <!-- Navigation Menu -->
            <div class="navigation-wrapper my-4">
                <!-- Desktop View -->
                <div class="d-none d-md-flex justify-content-center flex-wrap gap-2">
                    <button class="btn btn-primary" [class.active]="activeSection === 'profile'" (click)="setActiveSection('profile')">
                        <i class="fas fa-user-edit me-2"></i>Profile
                    </button>
                    <button class="btn btn-warning" [class.active]="activeSection === 'changePassword'" (click)="setActiveSection('changePassword')">
                        <i class="fas fa-key me-2"></i>Login Password
                    </button>
                    <button class="btn btn-success" [class.active]="activeSection === 'createPassword'" (click)="setActiveSection('createPassword')">
                        <i class="fas fa-lock me-2"></i>Transaction Password
                    </button>
                    <button class="btn btn-info" [class.active]="activeSection === 'referral-tree'" (click)="setActiveSection('referral-tree')">
                        <i class="fas fa-sitemap me-2"></i>Referral Tree
                    </button>
                    <button class="btn btn-secondary" [class.active]="activeSection === 'Transaction_history'" (click)="setActiveSection('Transaction_history')">
                        <i class="fas fa-history me-2"></i>Transactions
                    </button>
                    <button class="btn btn-danger" (click)="deleteUser()" *ngIf="!isAdminProfile">
                        <i class="fas fa-trash-alt me-2"></i>Delete User
                    </button>
                </div>

                <!-- Mobile View -->
                <select class="form-select d-md-none" (change)="onSectionChange($event)" [value]="activeSection">
                    <option value="profile">üìù Profile Update</option>
                    <option value="changePassword">üîë Login Password</option>
                    <option value="createPassword">üîí Transaction Password</option>
                    <option value="referral-tree">üå≥ Referral Tree</option>
                    <option value="Transaction_history">üìä Transaction History</option>
                    <option value="delete">üóëÔ∏è Delete User</option>
                </select>
            </div>
            

            <div class="row justify-content-center" *ngIf="activeSection === 'profile'">
                <div class="col-lg-6 col-md-8 col-sm-10">
                    <div class="card shadow-sm mt-5">
                        <div class="card-header text-white">
                            <h2 class="card-title text-center mb-0 text-white fw-bold">Profile</h2>
                        </div>
                        <div class="card-body">

                            <form [formGroup]="profileForm2" (ngSubmit)="updateProfile()">
                                <!-- Email -->
                                <div class="form-group mb-3">
                                    <label for="email">Email:</label>
                                    <input type="text" id="email" class="form-control" formControlName="email" />
                                </div>

                                <!-- Mobile -->
                                <div class="form-group mb-3">
                                    <label for="mobile">Mobile:</label>
                                    <input type="text" id="mobile" class="form-control" formControlName="mobile" />
                                </div>

                            </form>
                            <!-- Profile Form -->
                            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
                                <!-- User ID -->
                                <div class="form-group mb-3">
                                    <label for="userId">User ID:</label>
                                    <input type="text" id="userId" class="form-control" formControlName="userId" />
                                </div>

                                <!-- Full Name -->
                                <div class="form-group mb-3">
                                    <label for="name">Name:</label>
                                    <input type="text" id="name" class="form-control" formControlName="name" />
                                </div>

                                <!-- Email Verified -->
                                <div class="form-group mb-3">
                                    <label for="isEmailVerified">Email Verified:</label>
                                    <select id="isEmailVerified" class="form-select" formControlName="isEmailVerified">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                                <!-- Mobile Verified -->
                                <div class="form-group mb-3">
                                    <label for="isMobileVerified">Mobile Verified:</label>
                                    <select id="isMobileVerified" class="form-select"
                                        formControlName="isMobileVerified">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                                <!-- Withdraw Allowed -->
                                <div class="form-group mb-3">
                                    <label for="isWithdrawAllowed">Withdraw Allowed:</label>
                                    <select id="isWithdrawAllowed" class="form-select"
                                        formControlName="isWithdrawAllowed">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                                <!-- Staking Allowed -->
                                <div class="form-group mb-3">
                                    <label for="isStakingAllowed">Staking Allowed:</label>
                                    <select id="isStakingAllowed" class="form-select"
                                        formControlName="isStakingAllowed">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                                <!-- Internal Transfer Allowed -->
                                <div class="form-group mb-3">
                                    <label for="isInternalTransferAllowed">Internal Transfer Allowed:</label>
                                    <select id="isInternalTransferAllowed" class="form-select"
                                        formControlName="isInternalTransferAllowed">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                                <!-- Available for Reward -->
                                <div class="form-group mb-3">
                                    <label for="isAvailableForReward">Available for Reward:</label>
                                    <select id="isAvailableForReward" class="form-select"
                                        formControlName="isAvailableForReward">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                                <!-- Submit Button -->
                                <button type="submit" 
                                        class="btn btn-primary btn-block"
                                        [disabled]="profileForm.invalid"
                                        (click)="scrollToTop()">
                                    Update Profile
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-8 col-sm-10">
                    <div class="card shadow-sm mt-5">
                        <div class="card-header text-white">
                            <h2 class="card-title text-center mb-0 text-white fw-bold">Profile</h2>
                        </div>
                        <div class="card-body">
                            <!-- Profile Form -->
                            <form [formGroup]="profileForm2" (ngSubmit)="updateProfile()">
                                <!-- Balnce -->
                                <div class="form-group mb-3">
                                    <label for="email">Balance:</label>
                                    <input readonly type="text" id="email" class="form-control" formControlName="BUSDBalance" />
                                </div>

                                <!-- Total Internal Transfer Balance -->
                                <div class="form-group mb-3">
                                    <label for="totalInternalTransferBalance">Trade Wallet Balance:</label>
                                    <input readonly type="text" id="totalInternalTransferBalance" class="form-control"
                                        formControlName="TRADEBalance" />
                                </div>


                                <!-- Bonus Balance -->
                                <div class="form-group mb-3">
                                    <label for="bonusBalance">Bonus Balance:</label>
                                    <input readonly type="text" id="bonusBalance" class="form-control"
                                        formControlName="bonusBalance" />
                                </div>

                                <!-- Total Staked Balance -->
                                <div class="form-group mb-3">
                                    <label for="totalStakedBalance">Total Staked Balance:</label>
                                    <input readonly type="text" id="totalStakedBalance" class="form-control"
                                        formControlName="totalStakedBalance" />
                                </div>

                            

                                <!-- Total Team Turnover Balance -->
                                <div class="form-group mb-3">
                                    <label for="totalTeamTurnoverBalance">Total Team Turnover Balance:</label>
                                    <input readonly type="text" id="totalTeamTurnoverBalance" class="form-control"
                                        formControlName="totalTeamTurnoverBalance" />
                                </div>

                               

                                <!-- Total Referral Reward Balance -->
                                <div class="form-group mb-3">
                                    <label for="totalReferralRewardBalance">Total Referral Reward Balance:</label>
                                    <input readonly type="text" id="totalReferralRewardBalance" class="form-control"
                                        formControlName="totalReferralRewardBalance" />
                                </div>

                                

                                <!-- Total Reward Balance -->
                                <div class="form-group mb-3">
                                    <label for="totalRewardBalance">Total Reward Balance:</label>
                                    <input readonly type="text" id="totalRewardBalance" class="form-control"
                                        formControlName="totalRewardBalance" />
                                </div>

                                <!-- Is TRX Pass Created -->
                                <div class="form-group mb-3">
                                    <label for="isTrxPassCreated">Is TRX Pass Created:</label>
                                    <select id="isTrxPassCreated" class="form-select"
                                        formControlName="isTrxPassCreated">
                                        <option value="true">True</option>
                                        <option value="false">False</option>
                                    </select>
                                </div>

                              
                                <!-- Submit Button -->
                                <button type="submit" class="btn btn-primary btn-block"
                                [disabled]="profileForm2.invalid"
                                (click)="scrollToTop()">
                                <span>Update Profile</span>                              
                                </button>

                            </form>

                        </div>
                    </div>
                </div>
            </div>


            <div class="row justify-content-center" *ngIf="activeSection === 'changePassword'">
                <!-- Change Transaction Password -->
                <div class="card shadow-sm mt-5 col-12 col-md-6">
                    <div class="card-header text-white">
                        <h2 class="card-title text-center mb-0 text-white fw-bold">Change Login Password</h2>
                    </div>
                    <div class="card-body">
                        <form [formGroup]="chnageLoginPassword" (ngSubmit)="changeUserLoginPassword()">
                            <div class="form-group mb-3">
                                <label for="prevPassword">Previous Password:</label>
                                <div class="input-group">
                                    <input type="text" readonly [disabled]="true" id="prevPassword" class="form-control" formControlName="userId"
                                        required />

                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <label for="newPassword">New Password:</label>
                                <div class="input-group password-field">
                                    <input [type]="showNewPassword ? 'text' : 'password'" 
                                           id="newPassword"
                                           class="form-control" 
                                           formControlName="password" 
                                           placeholder="Enter new password"
                                           autocomplete="new-password"
                                           required />
                                    <button type="button" 
                                            class="btn btn-outline-secondary password-toggle"
                                            [attr.aria-label]="showNewPassword ? 'Hide password' : 'Show password'"
                                            (click)="showNewPassword = !showNewPassword">
                                        <i class="fa" [ngClass]="showNewPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                                    </button>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-warning btn-block"
                                [disabled]="chnageLoginPassword.invalid">
                                Change Password
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center" *ngIf="activeSection === 'createPassword'">
                <!-- Create Transaction Password -->
                <div class="card shadow-sm mt-5 col-12 col-md-6">
                    <div class="card-header text-white">
                        <h2 class="card-title text-center mb-0">Change Transaction Password</h2>
                    </div>
                    <div class="card-body">
                        <form [formGroup]="changeTraxPassword" (ngSubmit)="changeTranxPassword()">
                            <div class="form-group mb-3">
                                <label for="password">Password:</label>
                                <div class="input-group">
                                    <input type="text" readonly [disabled]="true" id="password" class="form-control" formControlName="userId"
                                        required />

                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <label for="cnfPassword">Confirm Password:</label>
                                <div class="input-group">
                                    <input [type]="showConfirmPassword ? 'text' : 'password'" id="cnfPassword"
                                        class="form-control" formControlName="password" required />
                                    <div class="input-group-append">
                                        <!-- <button type="button" class="btn btn-outline-secondary"
                                            (click)="showConfirmPassword = !showConfirmPassword">
                                            <i [class]="showConfirmPassword ? 'fa fa-eye-slash' : 'fa fa-eye'"></i>
                                        </button> -->
                                        <button type="button" 
                                            class="btn btn-outline-secondary password-toggle"
                                            [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
                                            (click)="showConfirmPassword = !showConfirmPassword">
                                        <i class="fa" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                                    </button>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block"
                                [disabled]="changeTraxPassword.invalid">
                                Create Password
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center" *ngIf="activeSection === 'referral-tree'">
                <!-- Tree View Column -->
                <div class="col-md-8 col-sm-10">
                    <div class="tree-container mt-4">
                        <div class="card custom-card">
                            <div class="card-header">
                                <h3 class="mb-0">
                                    <i class="fas fa-sitemap me-2"></i>Referral Network
                                </h3>
                            </div>
                            <div class="card-body dark-theme">
                                <p-tree [value]="nodes" 
                                       [filter]="true" 
                                       selectionMode="checkbox"
                                       (onNodeSelect)="onNodeSelect($event)" 
                                       styleClass="custom-tree"
                                       [style]="{'background': '#1E2329', 'border': 'none', 'padding': '1rem'}">
                                </p-tree>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Details Column -->
                <div class="col-md-4 col-sm-10">
                    <div class="details-container mt-4">
                        <div class="card custom-card">
                            <div class="card-header">
                                <h3 class="mb-0">
                                    <i class="fas fa-user-circle me-2"></i>Member Details
                                </h3>
                            </div>
                            <div class="card-body" *ngIf="selectedReferral">
                                <ul class="list-group list-group-flush custom-list">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-user me-2"></i>Name</span>
                                        <span class="detail-value">{{ selectedReferral.name }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-fingerprint me-2"></i>Referral Code</span>
                                        <span class="detail-value text-warning">{{ selectedReferral.referralCode }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-user-plus me-2"></i>Sponsor Code</span>
                                        <span class="detail-value text-warning">{{ selectedReferral.sponser }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-id-badge me-2"></i>Login ID</span>
                                        <span class="detail-value">{{ selectedReferral.loginId }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-envelope me-2"></i>Email</span>
                                        <span class="detail-value">{{ selectedReferral.email }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-gift me-2"></i>Total Reward</span>
                                        <span class="detail-value text-success">{{ selectedReferral.totalRewardBalance }} USDT</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-lock me-2"></i>Total Staked</span>
                                        <span class="detail-value text-success">{{ selectedReferral.totalStakedBalance }} USDT</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-users me-2"></i>Total Team</span>
                                        <span class="detail-value text-warning">{{ selectedReferral.totalTeam }}</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span class="detail-label"><i class="fas fa-chart-line me-2"></i>Team Turnover</span>
                                        <span class="detail-value text-success">{{ selectedReferral.totalTeamTurnoverBalance }} USDT</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body text-center" *ngIf="!selectedReferral">
                                <i class="fas fa-user-circle text-warning" style="font-size: 3rem;"></i>
                                <p class="text-white mt-3">Select a member to view details</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center" *ngIf="activeSection === 'Transaction_history'">
                <div class="col-md-12">
                    <div class="transaction-container">
                        <!-- Filter Section -->
                        <div class="filter-section">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="filter-group">
                                        <label for="transactionType" class="filter-label">Transaction Type</label>
                                        <div class="custom-select">
                                            <select id="transactionType" [(ngModel)]="transactionType" (ngModelChange)="applyFilters()">
                                                <option value="">All Transactions</option>
                                                <option value="BURN">Burn</option>
                                                <option value="DEPOSIT">Deposit</option>
                                                <option value="BOND-IN">Bond In</option>
                                                <option value="WITHDRAW">Withdraw</option>
                                                <option value="FUND-TRANSFER">Fund Transfer</option>
                                                <option value="CONVERT-REWARD">Convert Reward</option>
                                                <option value="BOND-REWARD">Bond Reward</option>
                                                <option value="SIGNUP-BONUS">Signup Bonus</option>
                                                <option value="LEVEL-AIR-DROP">Level Air Drop</option>
                                                <option value="REFER-INCOME">Refer Income</option>
                                                <option value="RANK-UPGRADE-BONUS">Rank Upgrade Bonus</option>
                                                <option value="DELEGATED-REWARD">Delegated Reward</option>
                                                <option value="SWAP-BUSD-TO-TRADE">Swap BUSD to Trade</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="filter-group">
                                        <label for="status" class="filter-label">Status</label>
                                        <div class="custom-select">
                                            <select id="status" [(ngModel)]="status" (ngModelChange)="applyFilters()">
                                                <option value="">All Status</option>
                                                <option value="COMPLETED">Completed</option>
                                                <option value="FAILED">Failed</option>
                                                <option value="PENDING">Pending</option>
                                                <option value="REJECTED">Rejected</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
            
                        <!-- Transaction Table -->
                        <div class="transaction-table-wrapper">
                            <div class="table-responsive">
                                <table class="transaction-table">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>Type</th>
                                            <th>Credit</th>
                                            <th>Debit</th>
                                            <!-- <th>Balance</th> -->
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let transaction of transactions; let i = index">
                                            <td>{{i + 1}}</td>
                                            <td>
                                                <span class="transaction-type">{{transaction.transactionType}}</span>
                                            </td>
                                            <td>
                                                <span class="amount credit" *ngIf="transaction.amount > 0">
                                                    {{transaction.amount}}
                                                </span>
                                                <span *ngIf="transaction.amount <= 0">-</span>
                                            </td>
                                            <td>
                                                <span class="amount debit" *ngIf="transaction.amount < 0">
                                                    {{transaction.amount}}
                                                </span>
                                                <span *ngIf="transaction.amount >= 0">-</span>
                                            </td>
                                            <!-- <td>{{transaction.currentBalance}}</td> -->
                                            <td>{{transaction.description}}</td>
                                            <td>
                                                <span class="status-badge" [ngClass]="transaction.status.toLowerCase()">
                                                    {{transaction.status}}
                                                </span>
                                            </td>
                                            <td>{{transaction.createdAt | date:'MMM dd, yyyy HH:mm'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
