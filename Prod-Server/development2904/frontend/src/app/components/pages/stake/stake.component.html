<div class="wrapper">
  <div id="content" class="active-content">
    <div class="container">
      <!-- Tariff Plans Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-dark text-warning">
              <h3 class="card-title mb-0"><i class="fas fa-chart-line me-2"></i>Select Investment Plan</h3>
            </div>
            <div class="card-body bg-dark">
              <div class="row g-3">
                <div class="col-12 col-sm-6 col-lg-3" *ngFor="let plan of plansArray">
                  <div class="card h-100 plan-card" [class.active-plan]="selectedPlan === plan.id"
                    (click)="selectPlan(plan)">
                    <div class="card-body text-center position-relative p-3 p-sm-4">
                      <!-- Plan Icon based on level -->
                      <div class="plan-icon mb-3">
                        <i class="fas fa-2x" [ngClass]="{
                          'fa-seedling text-success': plan.name === 'Basic',
                          'fa-rocket text-primary': plan.name === 'Advance',
                          'fa-gem text-info': plan.name === 'Premium',
                          'fa-crown text-warning': plan.name === 'Expert'
                        }"></i>
                      </div>

                      <h4 class="text-warning fw-bold mb-3">{{plan.name}}</h4>
                      <div class="plan-details">
                        <div class="return-badge mb-3 p-2">
                          <div class="rate-container">
                            <span class="daily-return display-6">{{plan.rate * 100}}%</span>
                            <small class="text-light opacity-75">Daily Return</small>
                          </div>
                        </div>
                        <div class="investment-range p-3">
                          <div class="range-item mb-2">
                            <i class="fas fa-arrow-down text-success me-2"></i>
                            <span class="label">Min:</span>
                            <span class="value">${{plan.min}}</span>
                          </div>
                          <div class="range-item">
                            <i class="fas fa-arrow-up text-danger me-2"></i>
                            <span class="label">Max:</span>
                            <span class="value">{{plan.max === 9999999999 ? 'Unlimited' : '$' + plan.max}}</span>
                          </div>
                        </div>
                      </div>
                      <!-- Selected indicator -->
                      <div class="selected-check" *ngIf="selectedPlan === plan.id">
                        <i class="fas fa-check-circle fa-2x"></i>
                      </div>
                      <!-- Touch hint for mobile -->
                      <div class="touch-hint d-sm-none" *ngIf="selectedPlan !== plan.id">
                        <small class="text-muted">Tap to select</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-12 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-dark text-warning">
              <h3 class="card-title mb-0"><i class="fas fa-wallet me-2"></i>Select Staking Method</h3>
            </div>
            <div class="card-body bg-dark">
              <div class="row justify-content-center">
                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="card h-100 method-card" [class.active-method]="stakingMethod === 'wallet'" (click)="selectStakingMethod('wallet')">
                    <div class="card-body text-center p-4">
                      <i class="fas fa-wallet fa-3x mb-3 text-primary"></i>
                      <h4 class="text-warning">Wallet Staking</h4>
                      <p class="text-light opacity-75">Stake directly from your wallet</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="card h-100 method-card" [class.active-method]="stakingMethod === 'deposit'" (click)="selectStakingMethod('deposit')">
                    <div class="card-body text-center p-4">
                      <i class="fas fa-coins fa-3x mb-3 text-success"></i>
                      <h4 class="text-warning">Deposit Staking</h4>
                      <p class="text-light opacity-75">Stake from your deposits</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Wallet Staking Form -->
        <div class="balance-type-selection col-md-5" *ngIf="stakingMethod === 'wallet'">
          <div class="card shadow-sm">
            <div class="card-header">
              <h3 class="card-title mb-0">Stake USDT from Wallet</h3>
            </div>
            <div class="card-body">
              <form [formGroup]="stakeForm" (ngSubmit)="stake()">
                <!-- Add Lock Period Selection -->
                <div class="form-group mb-3">
                  <label for="lockPeriod">Lock Period (Days)</label>
                  <select id="lockPeriod" class="form-control" formControlName="lockPeriod" required>
                    <option value="30">30 Days</option>
                    <option value="60">60 Days</option>
                    <option value="90">90 Days</option>
                    <option value="180">180 Days</option>
                  </select>
                </div>

                <!-- Existing Amount Input -->
                <div class="form-group mb-3">
                  <label for="stakeAmount">Amount to Deposit</label>
                  <div class="input-group">
                    <input type="number" id="stakeAmount" class="form-control" formControlName="amount"
                      (input)="calculateDailyReturn(); validateStakeAmount()" 
                      [max]="getSelectedPlan()?.max || 9999999999" required />
                    <span class="input-group-text">USDT</span>
                  </div>
                  <div class="invalid-feedback d-block" *ngIf="stakeForm.get('amount')?.errors?.['minimumRequired']">
                    {{stakeForm.get('amount')?.errors?.['minimumRequired']}}
                  </div>

                  <div class="info-section mt-2">
                    <div class="investment-info">
                      <span class="info-label">Investment Range:</span>
                      <span class="info-value" *ngIf="selectedPlan">${{getSelectedPlan()?.min}} -
                        {{getSelectedPlan()?.max === 9999999999 ? 'Unlimited' : '$' + getSelectedPlan()?.max}}</span>
                    </div>
                    <div class="returns-info" *ngIf="calculateDailyReturn()">
                      <span class="info-label">Returns:</span>
                      <span class="info-value">Daily ${{calculateDailyReturn()?.daily}} | Total
                        ${{calculateDailyReturn()?.total}}</span>
                    </div>
                  </div>

                  <!-- Rest of the existing form -->
                  <div class="form-group mb-3">
                    <label>Select Network</label>
                    <div class="network-buttons">
                      <button type="button" class="btn bep20"
                        [class.btn-primary]="stakeForm.get('network')?.value === 'BEP20'"
                        (click)="stakeForm.patchValue({network: 'BEP20'})">BEP20</button>
                      <button type="button" class="btn trc20"
                        [class.btn-primary]="stakeForm.get('network')?.value === 'TRC20'"
                        (click)="stakeForm.patchValue({network: 'TRC20'})">TRC20</button>
                    </div>
                  </div>
                  <button type="submit" class="generate-btn w-100" [disabled]="!isFormValid">
                    Generate Deposit Address
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Deposit Staking Form -->
        <div class="col-md-6" *ngIf="stakingMethod === 'deposit'">
          <div class="card shadow-sm">
            <div class="card-header">
              <h3 class="card-title mb-0">Stake from Deposits</h3>
            </div>
            <div class="balance-type-grid card-body">
              <form [formGroup]="depositStakeForm" (ngSubmit)="stakeFromDeposit()">
                <!-- Balance Type Selection -->
                <div class="form-group mb-4">
                  <label class="form-label fw-bold mb-3 d-block">Select Balance Type</label>
                  <div class="row">
                    <div class="col-md-4 mb-3" *ngFor="let balanceType of selectedBalanceTypes">
                      <div class="card balance-type-card" style="height: 180px;" 
                           [class.active]="balanceType.selected"
                           [class.selected-balance]="balanceType.selected"
                           [class.balance-type-item]="true"
                           [class.balance-checkbox-container]="true"
                           (click)="selectBalanceType(balanceType.type)">
                            <div class="selected-indicator" *ngIf="(balanceType.type == selectedBalanceType.type) && selectedBalanceType.selected">
                              <i class="fas fa-check-circle text-white"></i>
                            </div>
                        <div class="card-body text-center d-flex flex-column justify-content-center">
                          <div class="balance-icon mb-3">
                            <i class="fas fa-2x" 
                               [class.fa-piggy-bank]="balanceType.type === 'deposits'"
                               [class.fa-users]="balanceType.type === 'referrals'"
                               [class.fa-chart-line]="balanceType.type === 'returnInterest'"
                               [class.text-success]="balanceType.type === 'deposits'"
                               [class.text-primary]="balanceType.type === 'referrals'"
                               [class.text-info]="balanceType.type === 'returnInterest'"></i>
                          </div>
                          <h5 class="balance-type-name mb-2"
                              [class.text-success]="balanceType.type === 'deposits'"
                              [class.text-primary]="balanceType.type === 'referrals'">
                            {{balanceType.type | titlecase}}
                          </h5>
                          <div class="balance-amount">
                            <h4 class="mb-0 text-white">${{balanceComponents[balanceType.type]}}</h4>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Lock Period Selection -->
                <div class="form-group mb-3">
                  <label for="depositLockPeriod">Lock Period (Days)</label>
                  <select id="depositLockPeriod" class="form-control" formControlName="lockPeriod" required>
                    <option value="30">30 Days</option>
                    <option value="60">60 Days</option>
                    <option value="90">90 Days</option>
                    <option value="180">180 Days</option>
                  </select>
                </div>

                <!-- Amount Input -->
                <div class="form-group mb-3">
                  <label for="depositStakeAmount">Amount to Stake</label>
                  <div class="input-group">
                    <input type="number" id="depositStakeAmount" class="form-control" formControlName="amount"
                      (input)="calculateDepositDailyReturn(); validateDepositStakeAmount()" 
                      [max]="getSelectedPlan()?.max || 9999999999" required />
                    <span class="input-group-text">USDT</span>
                  </div>
                  /*check bonus is greater than equal to 10*/

                  <div class="form-check mb-3" *ngIf="balanceComponents['bonus'] >= 10">
                    <input class="form-check-input" type="checkbox" id="isBonusStake" formControlName="isBonusStake" (change)="onBonusStakeToggle()">
                    <label class="form-check-label" for="isBonusStake">
                      Add Signup 10$ bonus to stake
                    </label> 
                  </div>
                  <div class="invalid-feedback d-block" *ngIf="depositStakeForm.get('amount')?.errors?.['minimumRequired']">
                    {{depositStakeForm.get('amount')?.errors?.['minimumRequired']}}
                  </div>
                  <div class="invalid-feedback d-block" *ngIf="depositStakeForm.get('amount')?.errors?.['maximumRequired']">
                    {{depositStakeForm.get('amount')?.errors?.['maximumRequired']}}
                  </div>

                  <div class="info-section mt-2">
                    <div class="investment-info">
                      <span class="info-label">Investment Range:</span>
                      <span class="info-value" *ngIf="selectedPlan">${{getSelectedPlan()?.min}} -
                        {{getSelectedPlan()?.max === 9999999999 ? 'Unlimited' : '$' + getSelectedPlan()?.max}}</span>
                    </div>
                    <div class="returns-info" *ngIf="calculateDepositDailyReturn()">
                      <span class="info-label">Returns:</span>
                      <span class="info-value">Daily ${{calculateDepositDailyReturn()?.daily}} | Total
                        ${{calculateDepositDailyReturn()?.total}}</span>
                    </div>
                  </div>

                  <button type="submit" class="generate-btn w-100" [disabled]="!isDepositFormValid">
                    Stake from Deposits
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Right Column - QR Code and Verification -->
        <div class="col-md-7" *ngIf="imageShow && stakingMethod === 'wallet'">
          <div class="card shadow-sm">
            <div class="card-header">
              <h3 class="card-title mb-0">Deposit Address</h3>
            </div>
              <div class="card-body text-center">
                <div class="qr-wrapper">
                  <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" />
                </div>
                <div class="address-wrapper mt-3">
                  <div class="input-group">
                    <input type="text" class="form-control" [value]="depositAddress" readonly #addressInput />
                    <button class="btn" (click)="copyToClipboard(addressInput)">
                      Copy
                    </button>
                  </div>
                  <div class="alert alert-warning mt-2 py-2">
                    Only send USDT {{stakeForm.get('network')?.value}} to this address
                  </div>
                </div>

                <!-- Verification Section -->
                <div class="verify-section mt-3">
                  <p class="timer mb-2">Time remaining: {{ minutes }}:{{ seconds | number: '2.0' }}</p>
                  <input type="text" [(ngModel)]="transactionHash" class="form-control mb-2"
                    placeholder="Enter transaction hash" />
                  <button class="generate-btn w-100" (click)="verifyTransactionHash(transactionHash)">
                    Verify Transaction
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>